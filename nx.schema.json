{
	"$schema": "http://json-schema.org/draft-07/schema",
	"$id": "https://raw.githubusercontent.com/Mearman/BibGraph/refs/heads/main/nx.schema.json",
	"title": "BibGraph Nx Configuration",
	"description": "Extends Nx configuration with JSON Logic support for target inference",
	"allOf": [
		{
			"$ref": "https://raw.githubusercontent.com/nrwl/nx/master/packages/nx/schemas/nx-schema.json"
		}
	],
	"definitions": {
		"targetRule": {
			"type": "object",
			"description": "Rule for inferring a target",
			"properties": {
				"target": {
					"type": "string",
					"description": "Target name to infer"
				},
				"when": {
					"oneOf": [
						{ "$ref": "json-logic.schema.json#/definitions/jsonLogicRule" },
						{
							"type": "array",
							"items": { "$ref": "json-logic.schema.json#/definitions/jsonLogicRule" },
							"description": "Multiple conditions (implicit AND)"
						}
					],
					"description": "Condition(s) for when to infer this target"
				},
				"value": {
					"type": "object",
					"description": "Target configuration value (default: {})",
					"additionalProperties": true
				}
			},
			"required": ["target", "when"],
			"additionalProperties": false
		},
		"inferTargetsPluginOptions": {
			"type": "object",
			"description": "Options for infer-targets plugin",
			"properties": {
				"rules": {
					"type": "array",
					"items": { "$ref": "#/definitions/targetRule" },
					"description": "Rules for inferring targets"
				}
			},
			"additionalProperties": false
		}
	}
}
