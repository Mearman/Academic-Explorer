# Build Artifact Schema
# Defines the structure and validation rules for build artifacts shared between CI/CD jobs

artifact:
  name:
    type: string
    required: true
    pattern: "^[a-z0-9-]+$"
    description: "Unique identifier for the artifact within the workflow run"
    example: "build-artifacts"

  path:
    type: array
    required: true
    items:
      type: string
      pattern: "^[a-zA-Z0-9/_.*-]+$"
    minItems: 1
    description: "List of file paths or glob patterns to include in the artifact"
    examples:
      - "apps/web/dist"
      - "apps/cli/dist"
      - "packages/*/dist"

  retention-days:
    type: integer
    required: false
    minimum: 1
    maximum: 90
    default: 90
    description: "Number of days to retain the artifact before automatic deletion"
    recommendation: "Use 1 day for ephemeral build artifacts that are only needed within the workflow run"

  compression-level:
    type: integer
    required: false
    minimum: 0
    maximum: 9
    default: 6
    description: "gzip compression level (0=no compression, 9=maximum compression)"
    recommendation: "Default (6) provides good balance of speed and size"

constraints:
  total-size:
    maximum: 10737418240  # 10GB in bytes
    description: "GitHub Actions artifact storage limit per workflow run"

  parallel-uploads:
    maximum: 1
    description: "Only one artifact with the same name can be uploaded per workflow run"

validation-rules:
  - "artifact.name must be unique within the workflow run"
  - "artifact.path globs must match at least one file"
  - "Total size of all files in artifact.path must not exceed 10GB"
  - "artifact.retention-days must be between 1 and 90"

usage-example: |
  - name: Upload build artifacts
    uses: actions/upload-artifact@v4
    with:
      name: build-artifacts
      path: |
        apps/web/dist
        apps/cli/dist
        packages/*/dist
      retention-days: 1
      compression-level: 6
